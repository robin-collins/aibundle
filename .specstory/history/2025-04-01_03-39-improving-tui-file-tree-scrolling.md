<!-- Generated by SpecStory -->

# Improving TUI File Tree Scrolling (2025-04-01 14:09:58)

_**User**_

the file and folder tree is able to extend beyond the viewport of the tui, you can still interact with it, but you cannot see, the viewport should scroll with the selection hightlight so that you can view all files and folders, no matter the length, or length of you terminal

---

_**Assistant**_

Okay, I understand. You want the file list in the TUI to automatically scroll so that the currently selected item is always visible within the viewport.

To implement this, I need to ensure that the `ratatui::widgets::List` widget is correctly linked with the `ListState` managed within your `SelectionState`. When the `ListState` is updated (e.g., when you move the selection up or down), passing this updated state to the `List` widget during rendering allows Ratatui to automatically adjust the scroll position.

First, I'll examine how the file list is currently being rendered to see where the state needs to be correctly passed. I'll start by reading the `src/tui/views/main_view.rs` file.

---

Read file: src/tui/views/main_view.rs

---

It looks like the `MainView::render` function in `src/tui/views/main_view.rs` correctly passes the `selection_state` down to the `FileList::render` function.

The next step is to check how `FileList::render` in `src/tui/components/file_list.rs` uses this `selection_state`. Ratatui's `List` widget needs the associated `ListState` to manage selection highlighting and scrolling.

I'll now read the `src/tui/components/file_list.rs` file to see how the `List` is being rendered.

---

Read file: src/tui/components/file_list.rs

---

Okay, I've reviewed the code in `src/tui/components/file_list.rs`. The issue is that the `render` function is using a *clone* of the `ListState` from `app_state` instead of the actual `ListState` managed within `selection_state`. This prevents the `List` widget from knowing the correct selection and scroll offset.

To fix this, I need to make two changes:

1.  **Modify `src/tui/components/file_list.rs`**:
    *   Change the `render` function signature to accept a mutable reference `&mut SelectionState`.
    *   Remove the line `let mut list_state = app_state.list_state.clone();`.
    *   Pass `&mut selection_state.list_state` to `f.render_stateful_widget`.
2.  **Modify `src/tui/views/main_view.rs`**:
    *   Update the call to `self.file_list.render` to pass `selection_state` mutably. Note that the `render` function in `MainView` itself needs to accept `selection_state` as mutable.

I'll start by modifying `src/tui/components/file_list.rs`.

---

```diff
          area: Rect,
          app_state: &AppState,
-         selection_state: &SelectionState,
+         selection_state: &mut SelectionState,
      ) {
          let display_items = app_state.get_display_items();
              .block(Block::default().title("Files").borders(Borders::ALL));
  
-         let mut list_state = app_state.list_state.clone();
- 
-         f.render_stateful_widget(list_widget, area, &mut list_state);
+         f.render_stateful_widget(list_widget, area, &mut selection_state.list_state);
      }
  
```

---

Now, I need to update the `render` function in `src/tui/views/main_view.rs` to accept `selection_state` as mutable and pass it mutably to `file_list.render`.

---

```diff
          area: Rect,
          app_state: &AppState,
-         selection_state: &SelectionState,
+         selection_state: &mut SelectionState,
          search_state: &SearchState,
      ) {
```

---

Okay, I've modified `src/tui/components/file_list.rs` and `src/tui/views/main_view.rs`.

The next step is to ensure that the place where `MainView::render` is called (likely in the main TUI loop) also passes the `selection_state` mutably. I'll check `src/tui/app.rs` as that's the usual location for the TUI drawing loop.

---

Read file: src/tui/app.rs

---

You're right, I found the call to `main_view.render` within the `App::run` method in `src/tui/app.rs`. Currently, it's passing `selection_state` as an immutable reference (`&self.selection_state`).

To complete the fix, I need to change this to pass a mutable reference (`&mut self.selection_state`).

---

```diff
                  self.main_view.render(
                      f,
-                     f.area(),
+                     f.size(),
                      &self.state,
-                     &self.selection_state,
+                     &mut self.selection_state,
                      &self.search_state,
                  )
```

---

All the necessary changes have been made:

1.  `src/tui/components/file_list.rs`: The `render` function now accepts `&mut SelectionState` and passes `&mut selection_state.list_state` to `render_stateful_widget`.
2.  `src/tui/views/main_view.rs`: The `render` function now accepts `&mut SelectionState` and passes it mutably to `file_list.render`.
3.  `src/tui/app.rs`: The call to `main_view.render` within the `terminal.draw` closure now passes `&mut self.selection_state`.

With these modifications, the `List` widget should now correctly receive the updated `ListState` during rendering, and Ratatui will handle the scrolling to keep the selected item in view automatically.

You should be able to run the application now and see the file list scroll as you navigate up and down.

---



---

